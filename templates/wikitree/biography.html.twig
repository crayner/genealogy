{% trans_default_domain 'messages' %}

{% extends "base.html.twig" %}

{% set date_format = 'l, jS F Y' %}
{% block body %}
    <h1>{{ 'WikiTree Biography Generator'|trans }}</h1>
    <p class="important">
       {{ 'Use the Wikitree ID of the profile for which you are creating a biography.'|trans }}
    </p>
    {{ form(form) }}
    <hr/>
    <p>{{ 'Privacy'|trans }}: {{ result.privacy|default('Not Set'|trans) }}</p>
    <p>{{ "Trusted List Access"|trans }}: {{ result.join|default('Not Set'|trans) }}</p>
    <hr/>
    {% if result.valid is same as true %}
        <h2>== {{ 'Biography'|trans }} ==</h2>
        {% set name = result.name.given %}
        {% if result.name.additional is not same as('') %}{% set name = name ~ ' ' ~ result.name.additional %}{% endif %}
        {% set name = name ~ ' ' ~ result.name.atBirth %}
        {% set gender = result.gender %}
        {% if gender is same as('') %}{% set gender = 'not_stated' %}{% endif %}
        {% if result.father.ID is not same as('') %}{% set father = '[[' ~ result.father.ID ~ '|' ~ result.father.name ~ ']]' %}{% else %}{% set father = 'birth.unknown.father'|trans %}{% endif %}
        {% if result.mother.ID is not same as('') %}{% set mother = '[[' ~ result.mother.ID ~ '|' ~ result.mother.name ~ ']]' %}{% else %}{% set mother = 'birth.unknown.mother'|trans %}{% endif %}
        <p>{{ 'birth.sentence'|trans({'name': name, 'date': result.birth.date|date(date_format), gender: gender, '{location}': result.birth.location, '{father}': father, '{mother}': mother}) }}</p>

        {% if (result.spouse|length > 0) %}
            {% for spouse in result.spouse %}
                <p>{{ 'marriage.sentence'|trans({'{preferred}': result.name.preferred,
                        '{spouse}': '[[' ~ spouse.ID ~ '|'~ spouse.name ~ ']]',
                        '{date}': spouse.date|date(date_format),
                        '{location}': spouse.location }) }}
                    {{ 'marriage.children'|trans({'{count}}': spouse.children|length}) }}</p>
                {% if spouse.children|length > 0 %}
                    <p>
                    {% for child in spouse.children %}
                        # [[{{ child.ID }}|{{ child.name }}]]<br />
                    {% endfor %}
                    </p>
                {% endif %}
            {% endfor %}
        {% endif %}

        {% if result.children|length > 0 %}
            {% for child in result.children %}
                <p># [[{{ child.ID }}|{{ child.name }}]]</p>
            {% endfor %}
        {% endif %}
        {% if result.death.date is not same as '' %}
            {% set tense = 'on' %}
            {% if result.death.before is same as(true) %}{% set tense = 'before' %}{% endif %}
            {% if result.death.after is same as(true) %}{% set tense = 'after' %}{% endif %}
            {% set age = 'death.age.years'|trans({count: result.age.y}) ~ ', ' ~ 'death.age.months'|trans({count: result.age.m}) ~ ', ' ~ 'death.age.days'|trans({count: result.age.d}) %}
            {% set age = age|replace({', ,': ','}) %}
            {% if tense is not same as('on') %}{% set age = 'death.age.calculation'|trans %}{% else %}{% set age = 'death.age.display'|trans({age: age|trim(' ,')}) %}{% endif %}
            <p>{{ 'death.sentence'|trans({tense: tense, '{preferred}': result.name.preferred, '{date}': result.death.date|date(date_format), '{location}': result.death.location}) }}{{ age }}.</p>
        {% endif %}
        <h2>== {{ 'Sources'|trans }} ==</h2>
        &lt;references /&gt;
    {% else %}
        {% if result.error is defined %}
            <p style="color: red; font-weight: bold;">{{ result.error|trans }}</p>
        {% endif %}
    {% endif %}
{% endblock %}